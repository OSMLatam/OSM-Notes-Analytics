#!/bin/bash

# Pre-push hook for OSM-Notes-Analytics (LIGHT VERSION)
# Runs quality tests only (fast) - DWH tests should be run manually in CI/CD
#
# To install: ln -sf ../../.git-hooks/pre-push .git/hooks/pre-push

set -e

echo "üöÄ Running pre-push validation (light mode)..."
echo ""

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Check if we're in the right directory
if [ ! -f "tests/run_quality_tests.sh" ]; then
    echo -e "${RED}‚ùå Not in project root directory${NC}"
    exit 1
fi

# Run quality tests only (fast)
echo -e "${BLUE}üîç Running quality tests...${NC}"
if ./tests/run_quality_tests.sh > /tmp/pre-push-quality.log 2>&1; then
    echo -e "${GREEN}‚úÖ Quality tests passed${NC}"
else
    echo -e "${RED}‚ùå Quality tests failed${NC}"
    echo "   See /tmp/pre-push-quality.log for details"
    cat /tmp/pre-push-quality.log
    exit 1
fi

echo ""
echo -e "${YELLOW}‚ÑπÔ∏è  Light mode: DWH tests skipped${NC}"
echo -e "${YELLOW}   Run manually: ./tests/run_dwh_tests.sh${NC}"
echo ""
echo -e "${GREEN}‚úÖ Pre-push validation complete!${NC}"
echo ""

exit 0

